The issue with the `convert_image` function is that it does not handle the case where the image format is 'JPEG' and the mode is 'RGB'. The function should only convert the image to 'RGB' if the format is 'PNG' and the mode is 'RGBA'. Additionally, the function should handle the case where a size is provided and create a thumbnail of the image with the specified size.

The bug is caused by the incorrect handling of image format and mode, as well as the incorrect creation of a thumbnail when a size is provided.

To fix the bug, we need to update the `convert_image` function to correctly handle the image format and mode, as well as create a thumbnail when a size is provided.

Here's the corrected code for the `convert_image` function:

```python
from PIL import Image
from io import BytesIO
from scrapy.pipelines.files import FilesPipeline

class ImagesPipeline(FilesPipeline):
    """
    Abstract pipeline that implement the image thumbnail generation logic
    """

    def convert_image(self, image, size=None):
        if image.format == 'PNG' and image.mode == 'RGBA':
            background = Image.new('RGBA', image.size, (255, 255, 255))
            background.paste(image, (0, 0), image)
            image = background.convert('RGB')
        if size:
            image = image.copy()
            image.thumbnail(size, Image.ANTIALIAS)
        buf = BytesIO()
        image.save(buf, 'JPEG')
        return image, buf
```

With this corrected code, the `convert_image` function should now handle the image format and mode correctly, as well as create a thumbnail when a size is provided. This should address the issues identified in the failing test and error message.