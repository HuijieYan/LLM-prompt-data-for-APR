{
    "scrapy:7": {
        "/Volumes/SSD2T/bgp_envs/repos/scrapy_7/scrapy/http/request/form.py": {
            "buggy_functions": [
                {
                    "function_name": "_get_form_url",
                    "function_code": "def _get_form_url(form, url):\n    if url is None:\n        return urljoin(form.base_url, form.action)\n    return urljoin(form.base_url, url)\n",
                    "decorators": [],
                    "docstring": null,
                    "start_line": 52,
                    "end_line": 55,
                    "variables": {
                        "url": [
                            53,
                            55
                        ],
                        "urljoin": [
                            54,
                            55
                        ],
                        "form.base_url": [
                            54,
                            55
                        ],
                        "form": [
                            54,
                            55
                        ],
                        "form.action": [
                            54
                        ]
                    },
                    "filtered_variables": {
                        "url": [
                            53,
                            55
                        ],
                        "urljoin": [
                            54,
                            55
                        ],
                        "form.base_url": [
                            54,
                            55
                        ],
                        "form": [
                            54,
                            55
                        ],
                        "form.action": [
                            54
                        ]
                    },
                    "diff_line_number": 54,
                    "class_data": null,
                    "variable_values": [
                        [
                            {
                                "url": {
                                    "variable_value": "None",
                                    "variable_type": "NoneType",
                                    "variable_shape": null
                                },
                                "urljoin": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                },
                                "form.base_url": {
                                    "variable_value": "'http://example.com'",
                                    "variable_type": "str",
                                    "variable_shape": "18"
                                },
                                "form": {
                                    "variable_value": "<Element form at 0x10b4ae540>",
                                    "variable_type": "FormElement",
                                    "variable_shape": null
                                },
                                "form.action": {
                                    "variable_value": "'http://example.com/path'",
                                    "variable_type": "str",
                                    "variable_shape": "23"
                                }
                            },
                            {
                                "url": {
                                    "variable_value": "None",
                                    "variable_type": "NoneType",
                                    "variable_shape": null
                                },
                                "urljoin": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                },
                                "form.base_url": {
                                    "variable_value": "'http://example.com'",
                                    "variable_type": "str",
                                    "variable_shape": "18"
                                },
                                "form": {
                                    "variable_value": "<Element form at 0x10b4ae540>",
                                    "variable_type": "FormElement",
                                    "variable_shape": null
                                },
                                "form.action": {
                                    "variable_value": "'http://example.com/path'",
                                    "variable_type": "str",
                                    "variable_shape": "23"
                                }
                            }
                        ]
                    ],
                    "angelic_variable_values": [
                        [
                            {
                                "url": {
                                    "variable_value": "None",
                                    "variable_type": "NoneType",
                                    "variable_shape": null
                                },
                                "action": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                },
                                "form.get": {
                                    "variable_value": "<bound method _Element.get of <Element form at 0x106e765e0>>",
                                    "variable_type": "method",
                                    "variable_shape": null
                                },
                                "form": {
                                    "variable_value": "<Element form at 0x106e765e0>",
                                    "variable_type": "FormElement",
                                    "variable_shape": null
                                },
                                "form.base_url": {
                                    "variable_value": "'http://example.com'",
                                    "variable_type": "str",
                                    "variable_shape": "18"
                                },
                                "urljoin": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                },
                                "strip_html5_whitespace": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                }
                            },
                            {
                                "url": {
                                    "variable_value": "None",
                                    "variable_type": "NoneType",
                                    "variable_shape": null
                                },
                                "action": {
                                    "variable_value": "' path\\n'",
                                    "variable_type": "str",
                                    "variable_shape": "6"
                                },
                                "form.get": {
                                    "variable_value": "<bound method _Element.get of <Element form at 0x106e765e0>>",
                                    "variable_type": "method",
                                    "variable_shape": null
                                },
                                "form": {
                                    "variable_value": "<Element form at 0x106e765e0>",
                                    "variable_type": "FormElement",
                                    "variable_shape": null
                                },
                                "form.base_url": {
                                    "variable_value": "'http://example.com'",
                                    "variable_type": "str",
                                    "variable_shape": "18"
                                },
                                "urljoin": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                },
                                "strip_html5_whitespace": {
                                    "variable_value": null,
                                    "variable_type": "None",
                                    "variable_shape": null
                                }
                            }
                        ]
                    ]
                }
            ],
            "snippets": [
                {
                    "snippet_code": "from six.moves.urllib.parse import urljoin, urlencode\nimport lxml.html\nfrom parsel.selector import create_root_node\nimport six\nfrom scrapy.http.request import Request",
                    "start_line": 7,
                    "end_line": 12
                }
            ],
            "inscope_functions": [
                "def _get_form_url(form, url):\n    if url is None:\n        return urljoin(form.base_url, form.action)\n    return urljoin(form.base_url, url)",
                "def _urlencode(seq, enc):\n    values = [(to_bytes(k, enc), to_bytes(v, enc))\n              for k, vs in seq\n              for v in (vs if is_listlike(vs) else [vs])]\n    return urlencode(values, doseq=1)",
                "def _get_form(response, formname, formid, formnumber, formxpath):\n    \"\"\"Find the form element \"\"\"\n    root = create_root_node(response.text, lxml.html.HTMLParser,\n                            base_url=get_base_url(response))\n    forms = root.xpath('//form')\n    if not forms:\n        raise ValueError(\"No <form> element found in %s\" % response)\n\n    if formname is not None:\n        f = root.xpath('//form[@name=\"%s\"]' % formname)\n        if f:\n            return f[0]\n\n    if formid is not None:\n        f = root.xpath('//form[@id=\"%s\"]' % formid)\n        if f:\n            return f[0]\n\n    # Get form element from xpath, if not found, go up\n    if formxpath is not None:\n        nodes = root.xpath(formxpath)\n        if nodes:\n            el = nodes[0]\n            while True:\n                if el.tag == 'form':\n                    return el\n                el = el.getparent()\n                if el is None:\n                    break\n        encoded = formxpath if six.PY3 else formxpath.encode('unicode_escape')\n        raise ValueError('No <form> element found with %s' % encoded)\n\n    # If we get here, it means that either formname was None\n    # or invalid\n    if formnumber is not None:\n        try:\n            form = forms[formnumber]\n        except IndexError:\n            raise IndexError(\"Form number %d not found in %s\" %\n                             (formnumber, response))\n        else:\n            return form",
                "def _get_inputs(form, formdata, dont_click, clickdata, response):\n    try:\n        formdata = dict(formdata or ())\n    except (ValueError, TypeError):\n        raise ValueError('formdata should be a dict or iterable of tuples')\n\n    inputs = form.xpath('descendant::textarea'\n                        '|descendant::select'\n                        '|descendant::input[not(@type) or @type['\n                        ' not(re:test(., \"^(?:submit|image|reset)$\", \"i\"))'\n                        ' and (../@checked or'\n                        '  not(re:test(., \"^(?:checkbox|radio)$\", \"i\")))]]',\n                        namespaces={\n                            \"re\": \"http://exslt.org/regular-expressions\"})\n    values = [(k, u'' if v is None else v)\n              for k, v in (_value(e) for e in inputs)\n              if k and k not in formdata]\n\n    if not dont_click:\n        clickable = _get_clickable(clickdata, form)\n        if clickable and clickable[0] not in formdata and not clickable[0] is None:\n            values.append(clickable)\n\n    values.extend(formdata.items())\n    return values",
                "def _value(ele):\n    n = ele.name\n    v = ele.value\n    if ele.tag == 'select':\n        return _select_value(ele, n, v)\n    return n, v",
                "def _select_value(ele, n, v):\n    multiple = ele.multiple\n    if v is None and not multiple:\n        # Match browser behaviour on simple select tag without options selected\n        # And for select tags wihout options\n        o = ele.value_options\n        return (n, o[0]) if o else (None, None)\n    elif v is not None and multiple:\n        # This is a workround to bug in lxml fixed 2.3.1\n        # fix https://github.com/lxml/lxml/commit/57f49eed82068a20da3db8f1b18ae00c1bab8b12#L1L1139\n        selected_options = ele.xpath('.//option[@selected]')\n        v = [(o.get('value') or o.text or u'').strip() for o in selected_options]\n    return n, v",
                "def _get_clickable(clickdata, form):\n    \"\"\"\n    Returns the clickable element specified in clickdata,\n    if the latter is given. If not, it returns the first\n    clickable element found\n    \"\"\"\n    clickables = [\n        el for el in form.xpath(\n            'descendant::*[(self::input or self::button)'\n            ' and re:test(@type, \"^submit$\", \"i\")]'\n            '|descendant::button[not(@type)]',\n            namespaces={\"re\": \"http://exslt.org/regular-expressions\"})\n        ]\n    if not clickables:\n        return\n\n    # If we don't have clickdata, we just use the first clickable element\n    if clickdata is None:\n        el = clickables[0]\n        return (el.get('name'), el.get('value') or '')\n\n    # If clickdata is given, we compare it to the clickable elements to find a\n    # match. We first look to see if the number is specified in clickdata,\n    # because that uniquely identifies the element\n    nr = clickdata.get('nr', None)\n    if nr is not None:\n        try:\n            el = list(form.inputs)[nr]\n        except IndexError:\n            pass\n        else:\n            return (el.get('name'), el.get('value') or '')\n\n    # We didn't find it, so now we build an XPath expression out of the other\n    # arguments, because they can be used as such\n    xpath = u'.//*' + \\\n            u''.join(u'[@%s=\"%s\"]' % c for c in six.iteritems(clickdata))\n    el = form.xpath(xpath)\n    if len(el) == 1:\n        return (el[0].get('name'), el[0].get('value') or '')\n    elif len(el) > 1:\n        raise ValueError(\"Multiple elements found (%r) matching the criteria \"\n                         \"in clickdata: %r\" % (el, clickdata))\n    else:\n        raise ValueError('No clickable element matching clickdata: %r' % (clickdata,))",
                "def __init__(self, *args, **kwargs):\n    formdata = kwargs.pop('formdata', None)\n    if formdata and kwargs.get('method') is None:\n        kwargs['method'] = 'POST'\n\n    super(FormRequest, self).__init__(*args, **kwargs)\n\n    if formdata:\n        items = formdata.items() if isinstance(formdata, dict) else formdata\n        querystr = _urlencode(items, self.encoding)\n        if self.method == 'POST':\n            self.headers.setdefault(b'Content-Type', b'application/x-www-form-urlencoded')\n            self._set_body(querystr)\n        else:\n            self._set_url(self.url + ('&' if '?' in self.url else '?') + querystr)",
                "@classmethod\ndef from_response(cls, response, formname=None, formid=None, formnumber=0, formdata=None,\n                  clickdata=None, dont_click=False, formxpath=None, formcss=None, **kwargs):\n\n    kwargs.setdefault('encoding', response.encoding)\n\n    if formcss is not None:\n        from parsel.csstranslator import HTMLTranslator\n        formxpath = HTMLTranslator().css_to_xpath(formcss)\n\n    form = _get_form(response, formname, formid, formnumber, formxpath)\n    formdata = _get_inputs(form, formdata, dont_click, clickdata, response)\n    url = _get_form_url(form, kwargs.pop('url', None))\n    method = kwargs.pop('method', form.method)\n    return cls(url=url, method=method, formdata=formdata, **kwargs)"
            ],
            "inscope_function_signatures": [
                "_get_form_url(form, url)",
                "_urlencode(seq, enc)",
                "_get_form(response, formname, formid, formnumber, formxpath)",
                "_get_inputs(form, formdata, dont_click, clickdata, response)",
                "_value(ele)",
                "_select_value(ele, n, v)",
                "_get_clickable(clickdata, form)",
                "__init__(self, *args, **kwargs)",
                "from_response(cls, response, formname=None, formid=None, formnumber=0, formdata=None, clickdata=None, dont_click=False, formxpath=None, formcss=None, **kwargs)"
            ],
            "variables_in_file": {
                "Request": [
                    17
                ],
                "formdata": [
                    129,
                    132,
                    46,
                    111,
                    49,
                    20,
                    21,
                    26,
                    27,
                    125
                ],
                "kwargs.pop": [
                    48,
                    20,
                    47
                ],
                "kwargs": [
                    39,
                    47,
                    48,
                    49,
                    20,
                    21,
                    22,
                    24
                ],
                "kwargs.get": [
                    21
                ],
                "__init__": [
                    24
                ],
                "super": [
                    24
                ],
                "FormRequest": [
                    24
                ],
                "self": [
                    33,
                    24,
                    28,
                    29,
                    30,
                    31
                ],
                "args": [
                    24
                ],
                "items": [
                    27,
                    28
                ],
                "isinstance": [
                    27
                ],
                "dict": [
                    27,
                    111
                ],
                "formdata.items": [
                    27,
                    132
                ],
                "querystr": [
                    33,
                    28,
                    31
                ],
                "_urlencode": [
                    28
                ],
                "self.encoding": [
                    28
                ],
                "self.method": [
                    29
                ],
                "self.headers.setdefault": [
                    30
                ],
                "self.headers": [
                    30
                ],
                "self._set_body": [
                    31
                ],
                "self._set_url": [
                    33
                ],
                "self.url": [
                    33
                ],
                "kwargs.setdefault": [
                    39
                ],
                "response.encoding": [
                    39
                ],
                "response": [
                    67,
                    68,
                    39,
                    71,
                    104,
                    45,
                    46
                ],
                "formcss": [
                    41,
                    43
                ],
                "formxpath": [
                    43,
                    45,
                    84,
                    85,
                    94
                ],
                "css_to_xpath": [
                    43
                ],
                "HTMLTranslator": [
                    43
                ],
                "form": [
                    128,
                    196,
                    101,
                    166,
                    106,
                    45,
                    46,
                    47,
                    48,
                    115,
                    54,
                    55,
                    186
                ],
                "_get_form": [
                    45
                ],
                "formname": [
                    73,
                    74,
                    45
                ],
                "formid": [
                    45,
                    78,
                    79
                ],
                "formnumber": [
                    104,
                    101,
                    99,
                    45
                ],
                "_get_inputs": [
                    46
                ],
                "dont_click": [
                    46,
                    127
                ],
                "clickdata": [
                    128,
                    195,
                    201,
                    203,
                    46,
                    176,
                    183
                ],
                "url": [
                    49,
                    55,
                    53,
                    47
                ],
                "_get_form_url": [
                    47
                ],
                "method": [
                    48,
                    49
                ],
                "form.method": [
                    48
                ],
                "cls": [
                    49
                ],
                "classmethod": [
                    35
                ],
                "urljoin": [
                    54,
                    55
                ],
                "form.base_url": [
                    54,
                    55
                ],
                "form.action": [
                    54
                ],
                "values": [
                    130,
                    132,
                    133,
                    59,
                    123,
                    62
                ],
                "to_bytes": [
                    59
                ],
                "k": [
                    59,
                    60,
                    123,
                    124,
                    125
                ],
                "enc": [
                    59
                ],
                "v": [
                    59,
                    138,
                    140,
                    141,
                    155,
                    156,
                    146,
                    151,
                    123,
                    124,
                    61
                ],
                "vs": [
                    60,
                    61
                ],
                "seq": [
                    60
                ],
                "is_listlike": [
                    61
                ],
                "urlencode": [
                    62
                ],
                "root": [
                    67,
                    69,
                    74,
                    79,
                    85
                ],
                "create_root_node": [
                    67
                ],
                "response.text": [
                    67
                ],
                "lxml.html.HTMLParser": [
                    67
                ],
                "lxml.html": [
                    67
                ],
                "lxml": [
                    67
                ],
                "get_base_url": [
                    68
                ],
                "forms": [
                    101,
                    69,
                    70
                ],
                "root.xpath": [
                    74,
                    85,
                    69,
                    79
                ],
                "ValueError": [
                    71,
                    200,
                    203,
                    112,
                    113,
                    95
                ],
                "f": [
                    74,
                    75,
                    76,
                    79,
                    80,
                    81
                ],
                "nodes": [
                    85,
                    86,
                    87
                ],
                "el": [
                    196,
                    197,
                    166,
                    198,
                    186,
                    199,
                    201,
                    177,
                    178,
                    87,
                    89,
                    90,
                    91,
                    92,
                    190
                ],
                "el.tag": [
                    89
                ],
                "el.getparent": [
                    91
                ],
                "encoded": [
                    94,
                    95
                ],
                "six.PY3": [
                    94
                ],
                "six": [
                    195,
                    94
                ],
                "formxpath.encode": [
                    94
                ],
                "IndexError": [
                    187,
                    102,
                    103
                ],
                "TypeError": [
                    112
                ],
                "inputs": [
                    115,
                    124
                ],
                "form.xpath": [
                    115,
                    196,
                    166
                ],
                "_value": [
                    124
                ],
                "e": [
                    124
                ],
                "clickable": [
                    128,
                    129,
                    130
                ],
                "_get_clickable": [
                    128
                ],
                "values.append": [
                    130
                ],
                "values.extend": [
                    132
                ],
                "n": [
                    137,
                    140,
                    141,
                    150,
                    156
                ],
                "ele.name": [
                    137
                ],
                "ele": [
                    137,
                    138,
                    139,
                    140,
                    145,
                    149,
                    154
                ],
                "ele.value": [
                    138
                ],
                "ele.tag": [
                    139
                ],
                "_select_value": [
                    140
                ],
                "multiple": [
                    145,
                    146,
                    151
                ],
                "ele.multiple": [
                    145
                ],
                "o": [
                    155,
                    149,
                    150
                ],
                "ele.value_options": [
                    149
                ],
                "selected_options": [
                    154,
                    155
                ],
                "ele.xpath": [
                    154
                ],
                "strip": [
                    155
                ],
                "o.get": [
                    155
                ],
                "o.text": [
                    155
                ],
                "clickables": [
                    177,
                    172,
                    165
                ],
                "el.get": [
                    178,
                    190
                ],
                "nr": [
                    184,
                    186,
                    183
                ],
                "clickdata.get": [
                    183
                ],
                "list": [
                    186
                ],
                "form.inputs": [
                    186
                ],
                "xpath": [
                    194,
                    196
                ],
                "join": [
                    195
                ],
                "c": [
                    195
                ],
                "six.iteritems": [
                    195
                ],
                "len": [
                    197,
                    199
                ],
                "get": [
                    198
                ]
            },
            "filtered_variables_in_file": {
                "Request": [
                    17
                ],
                "formdata": [
                    129,
                    132,
                    46,
                    111,
                    49,
                    20,
                    21,
                    26,
                    27,
                    125
                ],
                "kwargs.pop": [
                    48,
                    20,
                    47
                ],
                "kwargs": [
                    39,
                    47,
                    48,
                    49,
                    20,
                    21,
                    22,
                    24
                ],
                "kwargs.get": [
                    21
                ],
                "__init__": [
                    24
                ],
                "FormRequest": [
                    24
                ],
                "self": [
                    33,
                    24,
                    28,
                    29,
                    30,
                    31
                ],
                "args": [
                    24
                ],
                "items": [
                    27,
                    28
                ],
                "formdata.items": [
                    27,
                    132
                ],
                "querystr": [
                    33,
                    28,
                    31
                ],
                "_urlencode": [
                    28
                ],
                "self.encoding": [
                    28
                ],
                "self.method": [
                    29
                ],
                "self.headers.setdefault": [
                    30
                ],
                "self.headers": [
                    30
                ],
                "self._set_body": [
                    31
                ],
                "self._set_url": [
                    33
                ],
                "self.url": [
                    33
                ],
                "kwargs.setdefault": [
                    39
                ],
                "response.encoding": [
                    39
                ],
                "response": [
                    67,
                    68,
                    39,
                    71,
                    104,
                    45,
                    46
                ],
                "formcss": [
                    41,
                    43
                ],
                "formxpath": [
                    43,
                    45,
                    84,
                    85,
                    94
                ],
                "css_to_xpath": [
                    43
                ],
                "HTMLTranslator": [
                    43
                ],
                "form": [
                    128,
                    196,
                    101,
                    166,
                    106,
                    45,
                    46,
                    47,
                    48,
                    115,
                    54,
                    55,
                    186
                ],
                "_get_form": [
                    45
                ],
                "formname": [
                    73,
                    74,
                    45
                ],
                "formid": [
                    45,
                    78,
                    79
                ],
                "formnumber": [
                    104,
                    101,
                    99,
                    45
                ],
                "_get_inputs": [
                    46
                ],
                "dont_click": [
                    46,
                    127
                ],
                "clickdata": [
                    128,
                    195,
                    201,
                    203,
                    46,
                    176,
                    183
                ],
                "url": [
                    49,
                    55,
                    53,
                    47
                ],
                "_get_form_url": [
                    47
                ],
                "method": [
                    48,
                    49
                ],
                "form.method": [
                    48
                ],
                "cls": [
                    49
                ],
                "urljoin": [
                    54,
                    55
                ],
                "form.base_url": [
                    54,
                    55
                ],
                "form.action": [
                    54
                ],
                "values": [
                    130,
                    132,
                    133,
                    59,
                    123,
                    62
                ],
                "to_bytes": [
                    59
                ],
                "k": [
                    59,
                    60,
                    123,
                    124,
                    125
                ],
                "enc": [
                    59
                ],
                "v": [
                    59,
                    138,
                    140,
                    141,
                    155,
                    156,
                    146,
                    151,
                    123,
                    124,
                    61
                ],
                "vs": [
                    60,
                    61
                ],
                "seq": [
                    60
                ],
                "is_listlike": [
                    61
                ],
                "urlencode": [
                    62
                ],
                "root": [
                    67,
                    69,
                    74,
                    79,
                    85
                ],
                "create_root_node": [
                    67
                ],
                "response.text": [
                    67
                ],
                "lxml.html.HTMLParser": [
                    67
                ],
                "lxml.html": [
                    67
                ],
                "lxml": [
                    67
                ],
                "get_base_url": [
                    68
                ],
                "forms": [
                    101,
                    69,
                    70
                ],
                "root.xpath": [
                    74,
                    85,
                    69,
                    79
                ],
                "f": [
                    74,
                    75,
                    76,
                    79,
                    80,
                    81
                ],
                "nodes": [
                    85,
                    86,
                    87
                ],
                "el": [
                    196,
                    197,
                    166,
                    198,
                    186,
                    199,
                    201,
                    177,
                    178,
                    87,
                    89,
                    90,
                    91,
                    92,
                    190
                ],
                "el.tag": [
                    89
                ],
                "el.getparent": [
                    91
                ],
                "encoded": [
                    94,
                    95
                ],
                "six.PY3": [
                    94
                ],
                "six": [
                    195,
                    94
                ],
                "formxpath.encode": [
                    94
                ],
                "inputs": [
                    115,
                    124
                ],
                "form.xpath": [
                    115,
                    196,
                    166
                ],
                "_value": [
                    124
                ],
                "e": [
                    124
                ],
                "clickable": [
                    128,
                    129,
                    130
                ],
                "_get_clickable": [
                    128
                ],
                "values.append": [
                    130
                ],
                "values.extend": [
                    132
                ],
                "n": [
                    137,
                    140,
                    141,
                    150,
                    156
                ],
                "ele.name": [
                    137
                ],
                "ele": [
                    137,
                    138,
                    139,
                    140,
                    145,
                    149,
                    154
                ],
                "ele.value": [
                    138
                ],
                "ele.tag": [
                    139
                ],
                "_select_value": [
                    140
                ],
                "multiple": [
                    145,
                    146,
                    151
                ],
                "ele.multiple": [
                    145
                ],
                "o": [
                    155,
                    149,
                    150
                ],
                "ele.value_options": [
                    149
                ],
                "selected_options": [
                    154,
                    155
                ],
                "ele.xpath": [
                    154
                ],
                "strip": [
                    155
                ],
                "o.get": [
                    155
                ],
                "o.text": [
                    155
                ],
                "clickables": [
                    177,
                    172,
                    165
                ],
                "el.get": [
                    178,
                    190
                ],
                "nr": [
                    184,
                    186,
                    183
                ],
                "clickdata.get": [
                    183
                ],
                "form.inputs": [
                    186
                ],
                "xpath": [
                    194,
                    196
                ],
                "join": [
                    195
                ],
                "c": [
                    195
                ],
                "six.iteritems": [
                    195
                ],
                "get": [
                    198
                ]
            }
        },
        "test_data": []
    }
}