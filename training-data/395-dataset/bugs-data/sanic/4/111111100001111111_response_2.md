The error occurs in the `url_for` function of the `Request` class. The error is caused by the `self.app.config.SERVER_NAME` attribute not being available, leading to a KeyError.

The bug arises because the `SERVER_NAME` attribute is missing in the configuration and is accessed directly without proper handling. This causes the KeyError.

To fix this bug, the function needs to be modified to handle the absence of the `SERVER_NAME` attribute gracefully.

The corrected code for the `url_for` function is as follows:

```python
def url_for(self, view_name, **kwargs):
    """
    Same as :func:`sanic.Sanic.url_for`, but automatically determine
    `scheme` and `netloc` base on the request. Since this method is aiming
    to generate correct schema & netloc, `_external` is implied.

    :param kwargs: takes same parameters as in :func:`sanic.Sanic.url_for`
    :return: an absolute url to the given view
    :rtype: str
    """
    if not hasattr(self.app.config, 'SERVER_NAME'):
        return self.app.url_for(view_name, _external=True, **kwargs)

    scheme = self.scheme
    host = self.server_name
    port = self.server_port

    if (scheme.lower() in ("http", "ws") and port == 80) or (
        scheme.lower() in ("https", "wss") and port == 443
    ):
        netloc = host
    else:
        netloc = "{}:{}".format(host, port)

    return self.app.url_for(
        view_name, _external=True, _scheme=scheme, _server=netloc, **kwargs
    )
```

In this corrected code, a check is added to verify if the `SERVER_NAME` attribute exists in the configuration. If it does not exist, the function returns the URL generated by `app.url_for` with the `_external` flag set to `True`. This avoids the KeyError when `SERVER_NAME` is absent in the configuration.