The provided function has quite a large number of issues and it seems like a major refactoring is required to fix it. There are issues with various parts of the code including variable scopes, referencing, and looping.

Here's a simplified and refactored version of the function based on the provided code:

```python
def _clone_functional_model(model, input_tensors=None):
    if not isinstance(model, Model):
        raise ValueError('Expected `model` argument to be a `Model` instance, got ', model)
    if isinstance(model, Sequential):
        raise ValueError('Expected `model` argument to be a functional `Model` instance, got a `Sequential` instance instead:', model)

    input_layers = model._input_layers
    nodes_by_depth = model._nodes_by_depth
    outputs = model.outputs
    name = model.name

    # Clone layers in the model
    cloned_layers = []
    layer_map = {}
    for layer in input_layers:
        new_layer = layer.__class__.from_config(layer.get_config())
        cloned_layers.append(new_layer)
        layer_map[layer] = new_layer

    # Clone model nodes and update the tensor map
    tensor_map = {}
    for depth in sorted(nodes_by_depth.keys(), reverse=True):
        for node in nodes_by_depth[depth]:
            inbound_layer = node.inbound_layer
            outbound_layer = node.outbound_layer

            # Clone the outbound layer if not already cloned
            if outbound_layer not in layer_map:
                new_outbound_layer = outbound_layer.__class__.from_config(outbound_layer.get_config())
                layer_map[outbound_layer] = new_outbound_layer
            else:
                new_outbound_layer = layer_map[outbound_layer]

            # Update tensor map
            for i, input_tensor in enumerate(node.input_tensors):
                output_tensor = node.output_tensors[i]
                tensor_map[output_tensor] = (input_tensor, None)

    # Instantiate a new model from input_tensors and output_tensors
    if input_tensors is None:
        input_tensors = [layer.input for layer in cloned_layers]
    output_tensors = [tensor_map[output][0] for output in outputs]

    return Model(input_tensors, output_tensors, name=name)
```

In the refactored version, the code has been simplified and reorganized to properly clone the layers and nodes in the model, and to create a new model with the cloned layers and updated tensors. This should make the function more robust and reduce the likelihood of errors.