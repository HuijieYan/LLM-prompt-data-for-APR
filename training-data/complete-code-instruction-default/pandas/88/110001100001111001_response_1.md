The bug in the function seems to be related to the recursive call of the pivot_table function within the loop. This recursive call does not take into account the input parameters, leading to incorrect results.

To fix this bug, we can create a new function to handle the recursive call and update the input parameters accordingly. This function should take care of updating the values, index, and columns parameters based on the input parameters provided. It should also handle the case when aggfunc is a list, similar to the current implementation.

Here's the corrected code for the buggy function:

```python
from pandas import DataFrame, MultiIndex, concat
from pandas.api.types import is_list_like
from pandas.core.dtypes.common import is_integer_dtype
from pandas.core.groupby.generic import Grouper
from pandas.core.internals.construction import maybe_downcast_to_dtype
from pandas.core.reshape.pivot import _convert_by, _add_margins

def recursive_pivot_table(
    data,
    values,
    index,
    columns,
    aggfunc,
    fill_value,
    margins,
    dropna,
    margins_name,
    observed
):
    index = _convert_by(index)
    columns = _convert_by(columns)

    if isinstance(aggfunc, list):
        pieces = []
        keys = []
        for func in aggfunc:
            table = recursive_pivot_table(
                data,
                values=values,
                index=index,
                columns=columns,
                fill_value=fill_value,
                aggfunc=func,
                margins=margins,
                dropna=dropna,
                margins_name=margins_name,
                observed=observed,
            )
            pieces.append(table)
            keys.append(getattr(func, "__name__", func))

        return concat(pieces, keys=keys, axis=1)

    # Rest of the code remains the same
    keys = index + columns
    # ... (rest of the code)

@Substitution("\ndata : DataFrame")
@Appender(_shared_docs["pivot_table"], indents=1)
def pivot_table(
    data,
    values=None,
    index=None,
    columns=None,
    aggfunc="mean",
    fill_value=None,
    margins=False,
    dropna=True,
    margins_name="All",
    observed=False
) -> "DataFrame":
    return recursive_pivot_table(
        data,
        values=values,
        index=index,
        columns=columns,
        aggfunc=aggfunc,
        fill_value=fill_value,
        margins=margins,
        dropna=dropna,
        margins_name=margins_name,
        observed=observed
    )
```

The corrected code addresses the issue with the recursive call and ensures that the input parameters are correctly updated during each recursive call. This should resolve the discrepancies observed in the output variables.

Please use the provided corrected code to replace the original buggy function.