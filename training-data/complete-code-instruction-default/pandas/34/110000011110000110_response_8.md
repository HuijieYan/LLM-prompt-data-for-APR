```python
import pandas as pd
from datetime import datetime
from pandas.tseries.frequencies import to_offset

def _get_time_bins(self, ax):
    if not isinstance(ax, pd.DatetimeIndex):
        raise TypeError(
            "axis must be a DatetimeIndex, but got "
            f"an instance of {type(ax).__name__}"
        )

    idx = ax
    if isinstance(idx, pd.DatetimeIndex):
        idx = idx.asi8

    if len(idx) == 0:
        binner = labels = pd.DatetimeIndex(data=[], freq=self.freq, name=ax.name)
        return binner, [], labels

    if not isinstance(self.freq, to_offset):
        freq = to_offset(self.freq)
        first, last = _get_timestamp_range_edges(
            idx.min(), idx.max(), freq, closed=self.closed, base=self.base
        )

        if isinstance(first, pd.Timestamp) and isinstance(last, pd.Timestamp):
            # GH #12037
            # use first/last directly instead of call replace() on them
            # because replace() will swallow the nanosecond part
            # thus last bin maybe slightly before the end if the end contains
            # nanosecond part and lead to `Values falls after last bin` error
            binner = labels = pd.date_range(
                start=first, end=last, freq=freq, tz=ax.tz, name=ax.name, ambiguous="infer", nonexistent="shift_forward"
            )

            binner, bin_edges = self._adjust_bin_edges(binner, idx)

            # general version, knowing nothing about relative frequencies
            bins = lib.generate_bins_dt64(
                idx, bin_edges, self.closed, hasnans=idx.hasnans
            )

            if self.closed == "right":
                labels = binner
                if self.label == "right":
                    labels = labels[1:]
            elif self.label == "right":
                labels = labels[1:]

            if idx.hasnans:
                binner = binner.insert(0, pd.NaT)
                labels = labels.insert(0, pd.NaT)

            # if we end up with more labels than bins
            # adjust the labels
            # GH4076
            if len(bins) < len(labels):
                labels = labels[: len(bins)]

            return binner, bins, labels
        else:
            return [], [], []

def test_downsample_dst_at_midnight():
    # GH 25758
    start = datetime(2018, 11, 3, 12)
    end = datetime(2018, 11, 5, 12)
    index = pd.date_range(start, end, freq="1H")
    index = index.tz_localize("UTC").tz_convert("America/Havana")
    data = list(range(len(index)))
    dataframe = pd.DataFrame(data, index=index)
    result = dataframe.groupby(pd.Grouper(freq="1D")).mean()
    expected = pd.DataFrame(
        [7.5, 28.0, 44.5],
        index=pd.date_range("2018-11-03", periods=3).tz_localize(
            "America/Havana", ambiguous=True
        ),
    )
    pd.testing.assert_frame_equal(result, expected)
```