The cause of the bug is that the `pivot_table` function is not handling multi-index columns properly and is raising an AttributeError when trying to access the `nlevels` attribute of the `table.columns` object.

The issue is related to the processing of multi-index columns when using the `pivot_table` function.

To fix this bug, the `pivot_table` function needs to be updated to properly handle multi-index columns by checking for the number of levels in the columns index before attempting to access it.

Here's the corrected code for the `pivot_table` function:

```python
from pandas import DataFrame, MultiIndex
from pandas.core.reshape.pivot import pivot_table
from pandas.util.testing import assert_frame_equal

def pivot_table(
    data,
    values=None,
    index=None,
    columns=None,
    aggfunc="mean",
    fill_value=None,
    margins=False,
    dropna=True,
    margins_name="All",
    observed=False,
) -> DataFrame:
    result = pivot_table(
        data,
        values=values,
        index=index,
        columns=columns,
        aggfunc=aggfunc,
        fill_value=fill_value,
        margins=margins,
        dropna=dropna,
        margins_name=margins_name,
        observed=observed,
    )

    if isinstance(result.columns, MultiIndex) and result.columns.nlevels > 1:
        result = result[result.columns.levels[0][0]]

    return result

# Run the failing test
def test_pivot_table_multiindex_only():
    df2 = DataFrame({('a', 'b'): [1, 2, 3], ('a', 'b'): [1, 2, 3], "c": [4, 5, 6]})
    result = pivot_table(values="c", columns=('a', 'b'))
    expected = DataFrame([[4, 5, 6]], columns=MultiIndex.from_tuples([(1, 1), (2, 2), (3, 3)], names=('a', 'b')), index=Index(["c"]))
    assert_frame_equal(result, expected)
```

This corrected code should handle multi-index columns properly and resolve the AttributeError issue, as well as pass the failing test case.