The bug in the `table_exists` function is that when `partition` is not None, the call to `run_hive_cmd` is incorrect. The string formatting is not done properly, and the call to `self.partition_spec(partition)` is also not correct. This is causing the function to not return the expected results.

The failing test cases are also not being passed because the function is not returning the expected values based on the input parameters.

To fix this bug, we need to properly format the string for the `run_hive_cmd` call and correctly use the `self.partition_spec` function. Additionally, we should return `True` if `table in stdout` is true, and `False` otherwise.

Here's the corrected code for the `table_exists` function:

```python
def table_exists(self, table, database='default', partition=None):
    if partition is None:
        stdout = run_hive_cmd('use {0}; show tables like "{1}";'.format(database, table))

        return stdout and table in stdout
    else:
        partition_str = ','.join(['{}={}'.format(key, value) for key, value in partition.items()])
        cmd = 'use {0}; show partitions {1} partition ({2})'.format(database, table, partition_str)
        stdout = run_hive_cmd(cmd)

        return bool(stdout)
```

With this corrected code, the `table_exists` function should now return the expected values based on the input parameters and should pass the failing test cases.