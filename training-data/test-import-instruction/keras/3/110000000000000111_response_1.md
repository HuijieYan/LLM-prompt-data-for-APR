```python
from keras.models import Model, Sequential
from keras.layers import Input, InputLayer
from keras.utils.generic_utils import to_list, has_arg
import keras.backend as K

def _clone_functional_model(model, input_tensors=None):
    if not isinstance(model, Model):
        raise ValueError('Expected `model` argument to be a `Model` instance, got ', model)
    if isinstance(model, Sequential):
        raise ValueError('Expected `model` argument to be a functional `Model` instance, got a `Sequential` instance instead:', model)

    layer_map = {}  # Cache for created layers.
    tensor_map = {}  # Map {reference_tensor: (corresponding_tensor, mask)}
    # ... (rest of the code remains the same as the original)
```