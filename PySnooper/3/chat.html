<html>
  <head>
    <title>ChatGPT Data Export</title>
    <style>
      body {
        margin: 20px;
      }
      h4 {
        font-family: sans-serif;
        margin: 0;
      }
      #root {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .conversation {
        border: 1px solid black;
        padding: 20px;
        background-color: #f3f3f3;
      }
      .message {
        white-space: pre-wrap;
        margin: 20px 0;
      }
      .author {
        font-weight: bold;
        margin-bottom: 4px;
      }
      .author::first-letter {
        text-transform: uppercase;
      }
    </style>
    <script>
      var jsonData = [{"title": "Fix Python Function Bug", "create_time": 1691482033.661292, "update_time": 1691484143.0, "mapping": {"d0b3ac5c-d59e-4eb3-83b9-19ae031b82f4": {"id": "d0b3ac5c-d59e-4eb3-83b9-19ae031b82f4", "message": {"id": "d0b3ac5c-d59e-4eb3-83b9-19ae031b82f4", "author": {"role": "system", "name": null, "metadata": {}}, "create_time": 1691482033.661624, "update_time": null, "content": {"content_type": "text", "parts": [""]}, "status": "finished_successfully", "end_turn": true, "weight": 1.0, "metadata": {}, "recipient": "all"}, "parent": "aaa1c78f-077e-48cb-b638-88ab59c5ed88", "children": ["aaa2e814-55bb-443a-9141-012744079e84"]}, "aaa1c78f-077e-48cb-b638-88ab59c5ed88": {"id": "aaa1c78f-077e-48cb-b638-88ab59c5ed88", "message": null, "parent": null, "children": ["d0b3ac5c-d59e-4eb3-83b9-19ae031b82f4"]}, "aaa2e814-55bb-443a-9141-012744079e84": {"id": "aaa2e814-55bb-443a-9141-012744079e84", "message": {"id": "aaa2e814-55bb-443a-9141-012744079e84", "author": {"role": "user", "name": null, "metadata": {}}, "create_time": 1691482033.667169, "update_time": null, "content": {"content_type": "text", "parts": ["You need to fix a bug in a python function, the buggy source code is following:"]}, "status": "finished_successfully", "end_turn": null, "weight": 1.0, "metadata": {"timestamp_": "absolute", "message_type": null}, "recipient": "all"}, "parent": "d0b3ac5c-d59e-4eb3-83b9-19ae031b82f4", "children": ["1ca5d027-b07a-433e-94e6-7c2ff52f6007"]}, "1ca5d027-b07a-433e-94e6-7c2ff52f6007": {"id": "1ca5d027-b07a-433e-94e6-7c2ff52f6007", "message": {"id": "1ca5d027-b07a-433e-94e6-7c2ff52f6007", "author": {"role": "assistant", "name": null, "metadata": {}}, "create_time": 1691482035.373705, "update_time": null, "content": {"content_type": "text", "parts": ["Of course, I&#x27;d be happy to help you fix the bug in your Python function! Please provide me with the buggy source code so that I can take a look and assist you in identifying and resolving the issue."]}, "status": "finished_successfully", "end_turn": true, "weight": 1.0, "metadata": {"finish_details": {"type": "stop", "stop": "&lt;|fim_suffix|&gt;"}, "is_complete": true, "message_type": null, "model_slug": "text-davinci-002-render-sha", "parent_id": "aaa2e814-55bb-443a-9141-012744079e84", "timestamp_": "absolute"}, "recipient": "all"}, "parent": "aaa2e814-55bb-443a-9141-012744079e84", "children": ["aaa26a3d-bc5d-43af-b085-ed7fad1fe139"]}, "aaa26a3d-bc5d-43af-b085-ed7fad1fe139": {"id": "aaa26a3d-bc5d-43af-b085-ed7fad1fe139", "message": {"id": "aaa26a3d-bc5d-43af-b085-ed7fad1fe139", "author": {"role": "user", "name": null, "metadata": {}}, "create_time": 1691482076.187657, "update_time": null, "content": {"content_type": "text", "parts": ["def get_write_function(output):\n    if output is None:\n        def write(s):\n            stderr = sys.stderr\n            stderr.write(s)\n    elif isinstance(output, (pycompat.PathLike, str)):\n        def write(s):\n            with open(output_path, &#x27;a&#x27;) as output_file:\n                output_file.write(s)\n    else:\n        assert isinstance(output, utils.WritableStream)\n        def write(s):\n            output.write(s)\n\n    return write"]}, "status": "finished_successfully", "end_turn": null, "weight": 1.0, "metadata": {"timestamp_": "absolute", "message_type": null}, "recipient": "all"}, "parent": "1ca5d027-b07a-433e-94e6-7c2ff52f6007", "children": ["ad49c2ac-6816-4d5d-870f-59f1ca118fd7"]}, "ad49c2ac-6816-4d5d-870f-59f1ca118fd7": {"id": "ad49c2ac-6816-4d5d-870f-59f1ca118fd7", "message": {"id": "ad49c2ac-6816-4d5d-870f-59f1ca118fd7", "author": {"role": "assistant", "name": null, "metadata": {}}, "create_time": 1691482085.367499, "update_time": null, "content": {"content_type": "text", "parts": ["It looks like you&#x27;ve provided a function that generates another function based on the `output` argument. The purpose of this code seems to be to provide a write function that can handle different types of output destinations. However, there are a couple of issues in the code you&#x27;ve shared:\n\n1. The `sys` and `pycompat` modules need to be imported for the code to work.\n2. The variable `output_path` should be replaced with `output` inside the second branch of the `if` statement.\n\nHere&#x27;s the corrected version of your code:\n\n```python\nimport sys\nfrom pathlib import Path\nfrom typing import Union\nfrom io import TextIOBase\n\ndef get_write_function(output: Union[None, str, Path, TextIOBase]):\n    if output is None:\n        def write(s):\n            stderr = sys.stderr\n            stderr.write(s)\n    elif isinstance(output, (Path, str)):\n        def write(s):\n            with open(output, &#x27;a&#x27;) as output_file:\n                output_file.write(s)\n    else:\n        assert isinstance(output, TextIOBase)\n        def write(s):\n            output.write(s)\n\n    return write\n```\n\nIn this corrected version, I&#x27;ve added appropriate imports for the required modules (`sys`, `pathlib`, and `TextIOBase`). I&#x27;ve also replaced `output_path` with `output` in the second branch, and used the correct types in type hints for better readability and code understanding."]}, "status": "finished_successfully", "end_turn": true, "weight": 1.0, "metadata": {"finish_details": {"type": "stop", "stop": "&lt;|fim_suffix|&gt;"}, "is_complete": true, "message_type": null, "model_slug": "text-davinci-002-render-sha", "parent_id": "aaa26a3d-bc5d-43af-b085-ed7fad1fe139", "timestamp_": "absolute"}, "recipient": "all"}, "parent": "aaa26a3d-bc5d-43af-b085-ed7fad1fe139", "children": ["aaa22240-c43d-4533-83f1-98f29f029a01"]}, "aaa22240-c43d-4533-83f1-98f29f029a01": {"id": "aaa22240-c43d-4533-83f1-98f29f029a01", "message": {"id": "aaa22240-c43d-4533-83f1-98f29f029a01", "author": {"role": "user", "name": null, "metadata": {}}, "create_time": 1691482587.885057, "update_time": null, "content": {"content_type": "text", "parts": ["Your fixed patch is functional correct, but the fiexed function looks different from the original source code. I need you to provide minimal changes so that your fixed patch can be replaced directly into original project."]}, "status": "finished_successfully", "end_turn": null, "weight": 1.0, "metadata": {"timestamp_": "absolute", "message_type": null}, "recipient": "all"}, "parent": "ad49c2ac-6816-4d5d-870f-59f1ca118fd7", "children": ["cfa02729-5d16-4ac7-9b4f-6838faca225f"]}, "cfa02729-5d16-4ac7-9b4f-6838faca225f": {"id": "cfa02729-5d16-4ac7-9b4f-6838faca225f", "message": {"id": "cfa02729-5d16-4ac7-9b4f-6838faca225f", "author": {"role": "assistant", "name": null, "metadata": {}}, "create_time": 1691482593.975342, "update_time": null, "content": {"content_type": "text", "parts": ["I apologize for the misunderstanding. Here&#x27;s the minimal change you can make to the original code while keeping the structure intact:\n\n```python\ndef get_write_function(output):\n    if output is None:\n        def write(s):\n            stderr = sys.stderr\n            stderr.write(s)\n    elif isinstance(output, (pycompat.PathLike, str)):\n        def write(s):\n            with open(output, &#x27;a&#x27;) as output_file:  # Change output_path to output\n                output_file.write(s)\n    else:\n        assert isinstance(output, utils.WritableStream)\n        def write(s):\n            output.write(s)\n\n    return write\n```\n\nThe only change needed is to replace `output_path` with `output` inside the second branch of the `if` statement. This should be a drop-in replacement for the original code."]}, "status": "finished_successfully", "end_turn": true, "weight": 1.0, "metadata": {"finish_details": {"type": "stop", "stop": "&lt;|fim_suffix|&gt;"}, "is_complete": true, "message_type": null, "model_slug": "text-davinci-002-render-sha", "parent_id": "aaa22240-c43d-4533-83f1-98f29f029a01", "timestamp_": "absolute"}, "recipient": "all"}, "parent": "aaa22240-c43d-4533-83f1-98f29f029a01", "children": []}}, "moderation_results": [], "current_node": "cfa02729-5d16-4ac7-9b4f-6838faca225f", "plugin_ids": null, "id": "0e6edda9-f8cc-489a-b31c-7d8ec75d3385"}]

      function getConversationMessages(conversation) {
          var messages = [];
          var currentNode = conversation.current_node;
          while (currentNode != null) {
              var node = conversation.mapping[currentNode];
              if (
                  node.message &&
                  node.message.content &&
                  node.message.content.content_type == "text"
                  && node.message.content.parts.length > 0 &&
                  node.message.content.parts[0].length > 0 &&
                  (node.message.author.role !== "system"  || node.message.metadata.is_user_system_message)
              ) {
                  author = node.message.author.role;
                  if (author === "assistant") {
                      author = "ChatGPT";
                  } else if (author === "system" && node.message.metadata.is_user_system_message) {
                      author = "Custom user info"
                  }
                  messages.push({ author, text: node.message.content.parts[0] });
              }
              currentNode = node.parent;
          }
          return messages.reverse();
      }

      // on load, add messages to the root div
      window.onload = function() {
          var root = document.getElementById("root");
          for (var i = 0; i < jsonData.length; i++) {
              var conversation = jsonData[i];
              var messages = getConversationMessages(conversation);
              var div = document.createElement("div");
              div.className = "conversation";
              div.innerHTML = "<h4>" + conversation.title + "</h4>";
              for (var j = 0; j < messages.length; j++) {
                  var message = document.createElement("pre");
                  message.className = "message";
                  message.innerHTML = `<div class="author">${messages[j].author}</div><div>${messages[j].text}</div>`;
                  div.appendChild(message);
              }
              root.appendChild(div);
          }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>