{
    "pandas:38": {
        "github_issue_title": [
            "Multiple unstack in multi level columns DataFrame\n",
            "Pandas unstack() unexpected behavior with multiindex row and column\n",
            "BUG in _unstack_multiple\n"
        ],
        "github_issue_description": [
            "Code Sample, a copy-pastable example if possible\nimport pandas as pd\nfrom six import StringIO\nstats = pd.DataFrame({('B', 'C'): \n                          {\n                              (10, 20, 30): 0.0,\n                              (10, 20, 40): 0.0\n                          },\n                      ('B', 'D'): \n                          {\n                              (10, 20, 30): 0.0, \n                              (10, 20, 40): 0.0\n                          }\n                     })\n\nstats.index.names = ['i1', 'i2', 'i3']\nstats.columns.names = ['c1', 'c2']\n\n# Expected true,  actual false\nstats.unstack(['i2', 'i1']).columns.names[-2:] == ['i2', 'i1']\n\n# In case of single level column, expected true, actual true\nstats['B'].unstack(['i2', 'i1']).columns.names[-2:] == ['i2', 'i1']\nProblem description\nTrying to unstack multiindex multicolumns DataFrame, yield to an unexpected behavior.\nThe unstacked levels are not those expected (see the code above).\n\nNote: In a single level column case, behavior is the expected one.\n\nExpected Output\nN/A\n",
            "Code Sample, a copy-pastable example if possible\ndata = {\n    ('effect_size', 'cohen_d', 'mean'): {\n        ('m1', 'P3', '222'): 0.52,\n        ('m1', 'A5', '111'): -0.07,\n        ('m2', 'P3', '222'): -0.53,\n        ('m2', 'A5', '111'): 0.05,\n    },\n    ('wilcoxon', 'z_score', 'stouffer'): {\n        ('m1', 'P3', '222'): 2.2,\n        ('m1', 'A5', '111'): -0.92,\n        ('m2', 'P3', '222'): -2.0,\n        ('m2', 'A5', '111'): -0.52,\n    }\n}\ndf = pd.DataFrame(data)\ndf.index.rename(['metric', 'bar', 'foo'], inplace=True)\ndf.unstack(['foo', 'bar'])\nProblem description\nThe df looks like this before unstacking:\n\n               effect_size wilcoxon\n                   cohen_d  z_score\n                      mean stouffer\nmetric bar foo                     \nm1     A5  111       -0.07    -0.92\n       P3  222        0.52     2.20\nm2     A5  111        0.05    -0.52\n       P3  222       -0.53    -2.00\nby unstacking bar and foo, I had expected to see them as column indices, but that's not what happens. Instead foo and metric are unstacked, and bar is left stacked as a row index:\n\n> df.unstack(['foo', 'bar'])\n\n       effect_size                   wilcoxon                \n           cohen_d                    z_score                \n              mean                   stouffer                \nfoo            111         222            111        222     \nmetric          m1    m2    m1    m2       m1    m2   m1   m2\nbar                                                          \nA5           -0.07  0.05   NaN   NaN    -0.92 -0.52  NaN  NaN\nP3             NaN   NaN  0.52 -0.53      NaN   NaN  2.2 -2.0\nI got around the problem by doing the following, but I think the above behavior might be a bug.\n\nHere's my workaround:\n\n> print df.stack([0, 1, 2]).unstack(0).transpose()\n\nbar             A5                   P3         \nfoo            111                  222         \n       effect_size wilcoxon effect_size wilcoxon\n           cohen_d  z_score     cohen_d  z_score\n              mean stouffer        mean stouffer\nmetric                                          \nm1           -0.07    -0.92        0.52      2.2\nm2            0.05    -0.52       -0.53     -2.0\n",
            "Code Sample\nNext code fail to do unstack.\n\nd = pd.DataFrame([[1,2,3],[2,2,3],[3,2,3],[4,2,3],[5,2,3]], \n                 columns=pd.MultiIndex.from_tuples([[0, 0, 0], [0, 0, 1], [0, 0, 2]], names=['c1', 'c2', 'c3']),\n                 index=pd.MultiIndex.from_tuples([[0, 0, 0, 0, 0, 0, 0],\n                                                  [0, 0, 1, 0, 0, 0, 1],\n                                                  [0, 1, 0, 0, 0, 1, 0],\n                                                  [0, 1, 1, 0, 0, 1, 1],\n                                                  [1, 0, 0, 0, 1, 0, 0]\n                                                  ], \n                                                 names=['i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7']))\ne = d.unstack(['i2', 'i3', 'i4', 'i5', 'i6', 'i7'])\nIt rise exception IndexError with message \"Too many levels: Index has only 2 levels, not 3\"\n\nProblem description\nThe reason semms to mistyping in https://github.com/pandas-dev/pandas/blob/master/pandas/core/reshape/reshape.py#L366 :\n\nclocs = [v if i > v else v - 1 for v in clocs]\nI think it must be:\n\nclocs = [v if val > v else v - 1 for v in clocs]\n"
        ]
    }
}