{
    "fastapi:4": {
        "github_issue_title": [
            "The generated OpenAPI schema duplicates parameter IDs when used with dependencies\n"
        ],
        "github_issue_description": [
            "Describe the bug\nThe generated OpenAPI schema duplicates parameter IDs when used with dependencies.\n\nTo Reproduce\nSteps to reproduce the behavior with a minimum self-contained file.\n\nCreate a file with:\nfrom fastapi import Depends, FastAPI\nfrom starlette.testclient import TestClient\n\napp = FastAPI()\n\n\nasync def user_exists(user_id: int):\n    return True\n\n\n@app.post(\"/users/{user_id}\", dependencies=[Depends(user_exists)])\nasync def bug(user_id: int):\n    pass\n\n\nclient = TestClient(app)\n\nopenapi_schema = {\n    \"openapi\": \"3.0.2\",\n    \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n    \"paths\": {\n        \"/users/{user_id}\": {\n            \"post\": {\n                \"summary\": \"Bug\",\n                \"operationId\": \"bug_users__user_id__post\",\n                \"parameters\": [\n                    {\n                        \"required\": True,\n                        \"schema\": {\"title\": \"User Id\", \"type\": \"integer\"},\n                        \"name\": \"user_id\",\n                        \"in\": \"path\",\n                    },\n                    # This duplicated user_id shouldn't be here\n                    # {\n                    #     \"required\": True,\n                    #     \"schema\": {\"title\": \"User Id\", \"type\": \"integer\"},\n                    #     \"name\": \"user_id\",\n                    #     \"in\": \"path\",\n                    # },\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"Successful Response\",\n                        \"content\": {\"application/json\": {\"schema\": {}}},\n                    },\n                    \"422\": {\n                        \"description\": \"Validation Error\",\n                        \"content\": {\n                            \"application/json\": {\n                                \"schema\": {\n                                    \"$ref\": \"#/components/schemas/HTTPValidationError\"\n                                }\n                            }\n                        },\n                    },\n                },\n            }\n        }\n    },\n    \"components\": {\n        \"schemas\": {\n            \"HTTPValidationError\": {\n                \"title\": \"HTTPValidationError\",\n                \"type\": \"object\",\n                \"properties\": {\n                    \"detail\": {\n                        \"title\": \"Detail\",\n                        \"type\": \"array\",\n                        \"items\": {\"$ref\": \"#/components/schemas/ValidationError\"},\n                    }\n                },\n            },\n            \"ValidationError\": {\n                \"title\": \"ValidationError\",\n                \"required\": [\"loc\", \"msg\", \"type\"],\n                \"type\": \"object\",\n                \"properties\": {\n                    \"loc\": {\n                        \"title\": \"Location\",\n                        \"type\": \"array\",\n                        \"items\": {\"type\": \"string\"},\n                    },\n                    \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                    \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n                },\n            },\n        }\n    },\n}\n\n\ndef test_reused_param():\n    response = client.get(\"/openapi.json\")\n    data = response.json()\n    assert data == openapi_schema\nRun it with pytest.\nAlternatively, you can run it with Uvicorn go to /openapi.json, copy that and validate it at: https://editor.swagger.io/ . It should be valid.\n\nExpected behavior\nThe user_id used by the path operation and the dependency shouldn't be duplicated in the OpenAPI schema.\n\nEnvironment\nOS: all\nFastAPI Version [e.g. 0.3.0], get it with: 0.48.0\npython -c \"import fastapi; print(fastapi.__version__)\"\nPython version, get it with: 3.7\npython --version\n"
        ]
    }
}