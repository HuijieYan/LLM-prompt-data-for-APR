The bug in the `table_exists` function is that it does not handle the case-insensitive comparison of table names correctly, and there is a problem with the handling of the `stdout` variable in the cases where it should return `True`.

To fix the bug, we need to modify the comparison of the table names to be case-insensitive and correctly handle the `stdout` variable to determine whether the table exists. 

Here's the corrected version of the `table_exists` function:

```python
def table_exists(self, table, database='default', partition=None):
    if partition is None:
        stdout = run_hive_cmd('use {0}; show tables;'.format(database))

        tables = stdout.split("\n")

        return any(t.lower() == table.lower() for t in tables)
    else:
        stdout = run_hive_cmd("""use {0}; show partitions {1} partition ({2})""".format(database, table, self.partition_spec(partition)))

        return bool(stdout)
```