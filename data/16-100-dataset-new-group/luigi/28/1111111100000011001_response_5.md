The bug in the `table_exists` function seems to be related to the `run_hive_cmd` function and the way it is being called. The function is using the `run_hive_cmd` function to execute Hive commands and check if a table exists in a given database. It also uses the `partition_spec` function to generate a partition specification. 

The bug seems to be in the `else` block where the `run_hive_cmd` function is called. It is not handling the output correctly and always returning `True`. 

To fix the bug, we need to check the output of the `run_hive_cmd` function and return `True` only if the table exists, otherwise return `False`. Additionally, the formatting of the command string in the `else` block also needs to be corrected.

Here's the corrected version of the `table_exists` function:

```python
class HiveCommandClient(HiveClient):
    # Other functions in the class

    def table_exists(self, table, database='default', partition=None):
        if partition is None:
            stdout = run_hive_cmd('use {0}; show tables like "{1}";'.format(database, table))
    
            return stdout and table in stdout
        else:
            partition_str = ','.join(["{}='{}'".format(key, value) for key, value in partition.items()])
            stdout = run_hive_cmd("use {0}; show partitions {1} partition ({2})".format(database, table, partition_str))
    
            if stdout.strip():
                return True
            else:
                return False
```

This corrected version checks the output of the `run_hive_cmd` function and returns `True` only if the table exists. It also formats the command string correctly in the `else` block when a partition is provided. 

This should fix the bug and satisfy all the given test cases.