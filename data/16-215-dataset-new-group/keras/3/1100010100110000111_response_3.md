The issue seems to be related to the `clone_model` function in the `keras/models.py` file. Specifically, the failing test indicates that the error occurs within the function `_clone_functional_model`.

The cause of the bug is related to the fact that the `Layer` subclass `Lambda`, which is used in the test case provided in the GitHub issue, doesn't support using masks. This results in the `layer.compute_mask` method always returning None, which leads to the error.

To fix the bug, we should modify the `_clone_functional_model` function to handle the case where the `Lambda` layer doesn't support masks and ensure that the output masks are handled correctly.

Here's the corrected version of the `_clone_functional_model` function:

```python
# Corrected version of the buggy function
def _clone_functional_model(model, input_tensors=None):
    # ... (existing code)
    for depth in depth_keys:
        nodes = model._nodes_by_depth[depth]
        for node in nodes:
            layer = node.outbound_layer

            if isinstance(layer, Lambda):
                # Lambda layer doesn't support masks, so we handle it differently
                # Instead of calling layer.compute_mask, we simply set output_masks to [None, None]
                reference_output_tensors = node.output_tensors
                output_masks = [None, None]
            else:
                reference_input_tensors = node.input_tensors
                reference_output_tensors = node.output_tensors
                # Rest of the code remains the same
                # ...

    # ... (existing code)

    # rest of the function remains the same
    # ...
    return Model(input_tensors, output_tensors, name=model.name)
```

In this corrected version, we handle the case where the `Lambda` layer is encountered during node iteration by setting `output_masks` to `[None, None]` directly, bypassing the computation of masks using `layer.compute_mask`.

This should address the issue reported in the failing test and the GitHub issue, ensuring that the `clone_model` function works as expected for models using the `Lambda` layer.