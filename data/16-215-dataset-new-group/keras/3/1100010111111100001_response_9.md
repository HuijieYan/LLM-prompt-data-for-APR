The bug in the `_clone_functional_model` function seems to be related to how it handles the input layers and their corresponding input tensors. The function is not properly creating the input layers and their tensors or caching them correctly, which leads to issues when attempting to compute the model outputs in the subsequent steps.

One strategy for fixing this bug is to ensure that the input layers and input tensors are properly created and cached. Additionally, the function needs to handle cases where the input tensors are not Keras tensors correctly to avoid errors during the computation of the model outputs.

Here's the corrected version of the `_clone_functional_model` function:

```python
def _clone_functional_model(model, input_tensors=None):
    if not isinstance(model, Model):
        raise ValueError('Expected `model` argument to be a `Model` instance, got ', model)
    
    if isinstance(model, Sequential):
        raise ValueError('Expected `model` argument to be a functional `Model` instance, got a `Sequential` instance instead:', model)
    
    layer_map = {}  # Cache for created layers.
    tensor_map = {}  # Map {reference_tensor: (corresponding_tensor, mask)}

    if input_tensors is None:
        input_tensors = [Input(batch_shape=layer.batch_input_shape, dtype=layer.dtype, sparse=layer.sparse, name=layer.name) for layer in model._input_layers]
        for original, cloned in zip(model._input_layers, input_tensors):
            layer_map[original] = cloned
    else:
        input_tensors = to_list(input_tensors)
        for i, x in enumerate(input_tensors):
            if not K.is_keras_tensor(x):
                name = model._input_layers[i].name
                input_tensor = Input(tensor=x, name='input_wrapper_for_' + name)
                input_tensors[i] = input_tensor
                layer_map[model._input_layers[i]] = input_tensor

    for x, y in zip(model.inputs, input_tensors):
        tensor_map[x] = (y, None)  # tensor, mask

    # Rest of the function remains unchanged
```

The updated function ensures that input layers and their corresponding input tensors are properly created and cached in the `layer_map` and `tensor_map`. This corrected version should address the issues encountered in the failing test.