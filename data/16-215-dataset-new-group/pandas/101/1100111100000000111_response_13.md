The bug in the `astype_nansafe` function is related to the incorrect conversion of categorical series back into an integer column, resulting in converting NaN to an incorrect integer negative value. The expected behavior is that NaN in the categorical column should convert to either NaN in an integer column or a float. The root cause of the issue is a mishandling of NaNs during the conversion process.

To fix the bug in the `astype_nansafe` function, we need to handle NaNs properly when converting categorical series into an integer column.

Here's the corrected version of the `astype_nansafe` function:

```python
def astype_nansafe(arr, dtype, copy: bool = True, skipna: bool = False):
    """
    Cast the elements of an array to a given dtype in a nan-safe manner.

    Parameters
    ----------
    arr : ndarray
    dtype : np.dtype
    copy : bool, default True
        If False, a view will be attempted but may fail, if
        e.g. the item sizes don't align.
    skipna: bool, default False
        Whether or not we should skip NaN when casting as a string-type.

    Raises
    ------
    ValueError
        The dtype was a datetime64/timedelta64 dtype, but it had no unit.
    """
    # (Code for handling extension dtype remains the same)

    if is_categorical(arr):
        if dtype == np.object or is_datetime_or_timedelta_dtype(dtype):
            return arr.astype(dtype, copy=copy)
        else:
            arr = arr.codes
            if is_integer_dtype(dtype) and isna(arr).any():
                return ensure_int64(arr, copy=copy)
            else:
                return arr.astype(dtype, copy=copy)

    # (The rest of the code remains the same)
```

The corrected version incorporates handling for categorical data separately. When converting categorical series into an integer dtype, it checks for NaNs and ensures that when the dtype is an integer and NaNs are present, the result is cast to an int64 to preserve the NaN values.

By making these changes, the bug related to incorrectly casting categorical NaNs to int values should be resolved.