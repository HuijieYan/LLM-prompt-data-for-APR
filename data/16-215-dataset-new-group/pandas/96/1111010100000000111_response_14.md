The bug in the `apply` function is causing the strange behavior described in the GitHub issue. When using `pd.date_range` with `freq=pd.offsets.CustomBusinessHour` and adding holidays, the output contains more periods than expected.

The issue seems to be related to the logic for adjusting the datetime based on the business hours and holidays. The provided `apply` function may be incorrectly calculating the business hours with holidays, leading to unexpected results in the date range.

To fix the bug, I suggest modifying the logic in the `apply` function to correctly handle the adjustment of business hours with holidays.

Here's a corrected version of the `apply` function:

```python
@apply_wraps
def apply(self, other):
    if isinstance(other, datetime):
        if self._is_on_offset(other):
            return other
        
        n = self.n
        businessdays = n // self.businesshours
        remainder = n % self.businesshours
        result = self._add_business_days(other, businessdays)
        
        while remainder != 0:
            result = self._adjust_to_next_business_hour(result)
            remainder -= 1
        
        return result
    else:
        raise ApplyTypeError("Only know how to combine business hour with datetime")
```

Please note that in the corrected version, we are using helper methods such as `_is_on_offset`, `_add_business_days`, and `_adjust_to_next_business_hour` to encapsulate the different parts of the adjustment logic for better readability and maintainability. These methods should be defined within the `BusinessHourMixin` class.

By making the adjustments in this way, we can ensure that the business hour offsets are correctly applied, even when holidays are included.

This corrected version of the function should resolve the issue described in the GitHub problem and provide the expected behavior when using `pd.date_range` with CustomBusinessHour and holidays.