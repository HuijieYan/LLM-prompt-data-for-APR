The bug is likely located in the `apply` function of the `BusinessHourMixin` class. The issue reported on GitHub indicates that when adding holidays using the `CustomBusinessHour` offset, the number of periods is incorrectly calculated, resulting in more periods than expected.

The `apply` function adjusts the given datetime based on the business hours, but it is likely not handling the inclusion of holidays correctly, which is causing the unexpected behavior when calculating the number of periods.

To fix this bug, we need to ensure that the `apply` function properly adjusts for holidays when calculating business hours and the number of periods. Additionally, the method to count business days and remaining business hours might be incorrect.

Here's the corrected version of the `apply` function:

```python
# Assuming the related classes and functions are properly implemented
class CustomBusinessHour:
    def __init__(self, start, holidays=None):
        self.start = start
        self.holidays = holidays

class BusinessDay:
    def __init__(self, n):
        self.n = n


class BusinessHourMixin:
    def apply(self, other):
        if isinstance(other, datetime):
            # previous code remains the same

            # get total business hours by sec in one business day
            businesshours = sum(
                self._get_business_hours_by_sec(st, en)
                for st, en in zip(self.start, self.end)
            )

            # handle holidays
            if self.holidays and other.date() in self.holidays:
                other = self.next_bday()
            
            # remaining code remains the same
            # ...
        else:
            raise ApplyTypeError("Only know how to combine business hour with datetime")
```

In the corrected version, we properly handle the holidays by checking if the date is in the list of holidays and adjusting accordingly before proceeding with the business hours calculation.

This correction should address the issue reported on GitHub and ensure that the `apply` function behaves as expected when adding holidays using the `CustomBusinessHour` offset.