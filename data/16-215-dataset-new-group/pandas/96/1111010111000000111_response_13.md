Based on the description, the bug in the `apply` function of the `BusinessHourMixin` class is causing the weird behavior in `pd.date_range` when using periods and adding holidays. The bug seems to be related to an incorrect adjustment of business days and business hours, resulting in more periods being added than expected when taking holidays into account.

To fix the bug, I would suggest revisiting the logic for adjusting business days and business hours in the `apply` function. Additionally, handling holidays should be incorporated into the adjustment process to ensure that the correct number of periods is generated.

Here's the corrected version of the `apply` function:

```python
@apply_wraps
def apply(self, other):
    if isinstance(other, datetime):
        n = self.n

        # Adjust for holidays
        if self._is_on_offset(other):
            while n > 0:
                other = self._next_opening_time(other)
                if other.date() in self.holidays:
                    continue
                n -= 1
            while n < 0:
                other = self._prev_opening_time(other)
                if other.date() in self.holidays:
                    continue
                n += 1

        # adjust for business hours
        if n >= 0:
            direction = 1
            hours = n
        else:
            direction = -1
            hours = -n

        while hours > 0:
            if direction == 1:
                other = self._next_opening_time(other)
            else:
                other = self._prev_opening_time(other)

            # skip holidays
            if other.date() in self.holidays:
                continue
            
            hours -= 1

        return other
    else:
        raise ApplyTypeError("Only know how to combine business hour with datetime")
```

This modified `apply` function now includes logic for adjusting for holidays and business hours, ensuring that the correct number of periods is generated when adding holidays to the `pd.date_range` call.

By implementing this fix, the `apply` function should now pass the failing test and resolve the GitHub issue.