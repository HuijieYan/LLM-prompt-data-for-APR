There seems to be an issue with the `apply` function inside the `CustomBusinessHour` class. The function is not correctly handling the holidays, which causes unexpected output for the `pd.date_range` function.

The bug occurs when the `apply` function incorrectly adjusts the date and time when handling holidays. The adjustment to the date and time is not taking into account the provided holidays, causing the function to produce incorrect output.

To fix the bug, the `apply` function needs to be updated to properly adjust the date and time when holidays are present. This can be achieved by checking if the date falls on a holiday and making necessary adjustments to ensure that the business hours are correctly calculated.

Here's the corrected version of the `apply` function inside the `CustomBusinessHour` class:

```python
@apply_wraps
def apply(self, other):
    if isinstance(other, datetime):
        # adjust other to reduce the number of cases to handle
        if self.is_on_offset(other):
            return other

        other = self._next_opening_time(other)
        holiday_adjusted = False

        while True:
            if other in self.holidays:
                other = self._next_opening_time(other)
                holiday_adjusted = True
            else:
                if holiday_adjusted:
                    other = self._get_closing_time(other)
                break

        return other
    else:
        raise ApplyTypeError("Only know how to combine business hour with datetime")
```

With this correction, the `apply` function will now properly handle holidays when adjusting the date and time, ensuring that the business hours are correctly calculated.

This fix will address the issue reported in the GitHub post and ensure that the `pd.date_range` function behaves as expected when using custom business hours with holidays.