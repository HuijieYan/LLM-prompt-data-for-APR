The issue seems to be related to the `pd.date_range` function when using custom business hours with periods and adding holidays. The user is experiencing unexpected behavior when adding holidays, resulting in more than the expected number of periods.

### Bug Description:
The `apply` function in the `BusinessHourMixin` class from the `offsets.py` file does not handle holidays correctly when adjusting business hours. This leads to unexpected behavior when using custom business hours with periods and adding holidays in the `pd.date_range` function. The failing test specifically demonstrates the issue when using `CustomBusinessHour` with a holiday specified, causing incorrect periods in the resulting `DatetimeIndex`.

### Strategy for Fixing the Bug:
To fix this bug, the `apply` function needs to properly account for holidays when adjusting business hours. It should calculate the correct number of periods, considering the presence of holidays in the specified business hours. Additionally, it should handle edge cases related to holidays that affect business hours. Given the error messages and the failing test case, it's essential to ensure that the adjustments made to the `other` datetime object in the `apply` function are compatible with custom business hours that include holidays.

### Corrected Version:
Here's a corrected version of the `apply` function that should address the bug:

```python
@apply_wraps
def apply(self, other):
    if isinstance(other, datetime):
        # ... (existing code remains unchanged)

        # adjust other to reduce number of cases to handle
        # ... (existing code remains unchanged)

        # get total business hours by sec in one business day
        businesshours = sum(
            self._get_business_hours_by_sec(st, en)
            for st, en in zip(self.start, self.end)
            if en not in self.holidays
        )

        # ... (existing code remains unchanged)
    else:
        raise ApplyTypeError("Only know how to combine business hour with datetime")
```

In the corrected version, the `businesshours` variable calculation has been updated to exclude the hours falling on holidays, ensuring that the count of business hours accurately reflects the available working hours.

After implementing this fix and making sure other parts of the `apply` function handle holidays appropriately, the `pd.date_range` function should behave as expected when using custom business hours with holidays and periods.

This corrected version should pass the failing test and resolve the issue reported on GitHub.