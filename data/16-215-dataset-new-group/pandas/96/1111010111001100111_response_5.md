Based on the failing test and the provided runtime input/output values, it is clear that the bug is causing incorrect behavior when a CustomBusinessHour includes a holiday. The issue posted in GitHub also mentions that the code works fine without a holiday but produces unexpected output when holidays are added.

The bug seems to be caused by the logic for adjusting the date when a holiday is encountered. This logic seems to be either skipping ahead or repeating some dates, leading to the unexpected behavior.

To fix this bug, we need to modify the `apply` function to handle holidays correctly. This could involve explicitly checking for holidays in the applied logic and adjusting the dates accordingly.

Let's provide the corrected version of the `apply` function below:

```python
class BusinessHourMixin(BusinessMixin):
    @apply_wraps
    def apply(self, other):
        if isinstance(other, datetime):
            # ... (existing logic)

            # adjust for holidays
            holiday_offset = timedelta(days=1) if self.weekmask == "Mon Tue Wed Thu Fri" else timedelta(days=1, hours=9)
            while other.date() in self.holidays:  # Check if the date is a holiday
                other += holiday_offset  # Skip the holiday

            # ... (remaining logic)

            return other
        else:
            raise ApplyTypeError("Only know how to combine business hour with datetime")
```

The corrected function includes a check for holidays and adjusts the date by one day if a holiday is encountered. This fix should address the issue described in the failing test and the GitHub issue.

By making these adjustments, the `apply` function should now correctly handle CustomBusinessHour with holidays, ensuring that the date range function and other related functionality work as expected.