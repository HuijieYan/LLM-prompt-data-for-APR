The bug in the `convert_image` function is related to the conditional logic for converting images to RGB format. The bug causes incorrect conversion and resizing of the images, leading to failing tests. The bug is primarily related to the conditional statements and the logic used to handle different image modes and formats.

To fix the bug, the conditional statements need to be adjusted to correctly handle PNG images with RGBA mode, and images of other modes that need to be converted to RGB. Additionally, the resizing logic needs to be updated to correctly handle the thumbnail resizing while maintaining the image ratio.

Here's the corrected version of the `convert_image` function:

```python
def convert_image(self, image, size=None):
    if image.format == 'JPEG' and image.mode != 'RGB':
        image = image.convert('RGB')
        
    if image.format == 'PNG' and image.mode == 'RGBA':
        background = Image.new('RGBA', image.size, (255, 255, 255))
        background.paste(image, (0, 0), image)
        image = background.convert('RGB')
    
    if size:
        image.thumbnail(size, Image.ANTIALIAS)

    buf = BytesIO()
    image.save(buf, 'JPEG')
    return image, buf
```

With the updated conditional statements and thumbnail handling, the corrected version of the `convert_image` function should pass the failing test cases.