## The fixed version of the buggy function
```python
from thefuck.types import Command


@git_support
def get_new_command(command: Command):
    push_upstream = command.stderr.split('\n')[-3].strip().partition('git ')[2].strip()
    if '--set-upstream' in command.script_parts:
        command.script_parts.remove('--set-upstream')
    if '-u' in command.script_parts:
        command.script_parts.remove('-u')
    
    return replace_argument(" ".join(command.script_parts), 'push', push_upstream)
```
By adding conditional checks whether '--set-upstream' or '-u' is in command.script_parts and removing it if it exists, we ensure that the correct command is constructed without duplicating these arguments. This also ensures that we avoid a potential Index error due to the incorrect removal of script parts.